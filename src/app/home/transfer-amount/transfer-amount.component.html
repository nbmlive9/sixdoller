<div class="dashboard-container">

  <!-- Header -->
  <app-header></app-header>

  <!-- Wallet Transfer Form Card -->
  <section class="stats-grid">
    <div class="stat-card gradient-cyan w-100">
      <h5 class="text-center">Wallet Transfer</h5>
      <h3 class="text-center mb-3">{{ pfdata?.actwallet | currency:'USD':true:'1.2-2' }}</h3>
            <small class="text-danger"> {{errorMessage}} </small>
      <form [formGroup]="form" novalidate>
        <div class="row">
          <div class="col-md-6 mb-2">
            <select class="form-control" formControlName="wallettype"  (change)="onWalletTypeChange()">
              <option value="" disabled>Select Wallet Type</option>
              <option value="dwallet">Activation Fund ({{ pfdata?.actwallet | currency:'USD':true:'1.2-2' }})</option>
              <option value="ewallet">Main Wallet ({{ pfdata?.walletamount | currency:'USD':true:'1.2-2' }})</option>
            </select>
            <div *ngIf="form.get('wallettype')?.invalid && form.get('wallettype')?.touched" class="text-danger small">
                wallettype is required 
              </div>
          </div>

          <div class="col-md-6 mb-2">
            <input type="number" class="form-control" min="1" placeholder="Amount ($)" formControlName="amount" (keyup)="onAmountChange()">
              <div *ngIf="form.get('amount')?.invalid && form.get('amount')?.touched" class="text-danger">
          Minimum Transfer Amount is $1
        </div>
              <!-- <div *ngIf="form.get('amount')?.invalid && form.get('amount')?.touched" class="text-danger small">
                Amount is required 
              </div> -->
              <div *ngIf="deductedAmount > 0 && form.get('wallettype')?.value === 'ewallet'"
                  class="text-danger fw-semibold mt-1">
               User will receive after 10% deduction: 
               <span class="text-primary">{{ deductedAmount | currency:'USD':true:'1.2-2' }}</span> 
              </div>
          </div>
          <div class="col-md-6 mb-2">
            <input type="text" class="form-control" placeholder="Enter User ID" formControlName="regid" (keyup)="onRegisterIdSelect($event)">
            <small class="text-white"> {{idselectmsg}} </small>
            <div *ngIf="form.get('regid')?.invalid && form.get('regid')?.touched" class="text-danger small">
                Userid is required 
              </div>
          </div>
          

            <div class="col-md-6 mb-2">
           <!-- <label class="form-label fw-semibold text-white">Secure Pin *</label> -->
                <input type="number" class="form-control crypto-input" placeholder="4 Digit PIN" formControlName="securepin"  (input)="onPinInput($event)" />

              <!-- Validation messages -->
              <div *ngIf="form.get('securepin')?.touched && form.get('securepin')?.invalid" class="text-danger small mt-1">
                <div *ngIf="form.get('securepin')?.errors?.['required']">
                  Secure PIN is required.
                </div>
                <div *ngIf="form.get('securepin')?.errors?.['pattern']">
                  Secure PIN must be exactly 4 digits.
                </div>
              </div>
          </div>


        </div>
        <div class="text-center mt-3">
          <button class="btn register-btn" type="button" (click)="Transfer()" [disabled]="!form.valid">Transfer</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Transfer Transactions -->
  <section class="extra-grid">
    <div class="w-100">
      <h5 class="text-center mb-3">Transfer Transactions</h5>
      <div *ngIf="tdata?.length > 0; else noTransactions">
        <div class="txn-card m-2" *ngFor="let row of tdata">
          <div class="txn-icon"><i class="bi bi-person"></i></div>
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between">
              <div class="txn-title">{{ row.userid }}</div>
              <div class="txn-amt text-white">{{ row.amount | currency:'USD':true:'1.0-2' }}</div>
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <div class="txn-sub">{{ row.cdate | date:'dd/MMM/yyyy' }} <br> ({{ row.ctime }}) </div>
              <span class="badge bg-success">Success</span>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noTransactions>
        <div class="text-center text-light">No transactions yet.</div>
      </ng-template>
    </div>
  </section>

  

</div>

<!-- ✅ Transfer Success Modal -->
<div class="modal fade" id="successTransferModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-3">

      <!-- Spinner before message -->
      <div *ngIf="loadingModal">
        <h4 class="text-success">Processing Transfer...</h4>
        <div class="spinner-border text-success mt-2"></div>
        <p class="mt-2">Please wait...</p>
      </div>

      <!-- Success message -->
      <div *ngIf="!loadingModal && successMessage">
        <h4 class="text-success">✅ Success</h4>
        <p class="mt-2">{{ successMessage }}</p>
      </div>

      <!-- Error message -->
      <div *ngIf="!loadingModal && errorMessage">
        <h4 class="text-danger">❌ Failed</h4>
        <p class="mt-2">{{ errorMessage }}</p>
      </div>

    </div>
  </div>
</div>


<!-- Footer Navigation -->
<app-footer></app-footer>

<!-- QR Scanner Modal -->
<!-- <div class="modal fade" id="qrScannerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Scan QR Code</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <zxing-scanner
          [formats]="allowedFormats"
          [tryHarder]="true"
          [autofocusEnabled]="true"
          [videoConstraints]="videoConstraints"
          (scanSuccess)="onScanSuccess($event)">
        </zxing-scanner>
      </div>
    </div>
  </div>
</div> -->

